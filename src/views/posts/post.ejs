
<head>
  <%- include('../partials/header') %>
  <title>CampusHub</title>
</head>

<%- include('../partials/navbar') %>
<main class="max-w-4xl mx-auto min-h-[80vh] py-12">
    <% if (currentUserId) { %>
      <a href="/posts" class="text-indigo-600 hover:text-indigo-500 font-medium mb-8 inline-block">
        &larr; Back to Feed
      </a>
    <% } else { %>
      <a href="/" class="text-indigo-600 hover:text-indigo-500 font-medium mb-8 inline-block">
        &larr; Back to Feed
      </a>
    <% } %>
    <article class="bg-white overflow-hidden">
        <header class="py-4">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-4 leading-tight">
                <%= post.title %>
            </h1>
            
            <div class="flex items-center text-gray-500 text-sm">
                <div class="h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-700 font-bold mr-3">
                    <%= post.author.username.charAt(0).toUpperCase() %>
                </div>
                <div>
                    <p class="font-semibold text-gray-900"><%= post.author.username %></p>
                    <p>Published on <%= post.createdAt.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) %></p>
                </div>
            </div>
        </header>

        <% if (post.fileLinks && post.fileLinks.length > 0) { %>
            <div class="rounded-xl overflow-hidden select-none pointer-events-none">
                <img src="<%= post.fileLinks[0] %>" alt="Post Image" class="w-full h-auto">
            </div>
        <% } %>

        <div class="py-8 prose prose-indigo max-w-none">
            <p class="text-gray-700 leading-relaxed whitespace-pre-line text-lg">
                <%= post.content %>
            </p>
        </div>

        <% if (currentUserId && currentUserId === post.author._id.toString()) { %>
            <footer class="flex items-center gap-4">
                <a href="/posts/edit/<%= post._id %>" 
                  class="px-5 py-3 bg-indigo-400 hover:bg-indigo-500 text-white rounded-lg text-sm font-semibold transition-all flex gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pen-line-icon lucide-pen-line"><path d="M13 21h8"/><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/></svg>  
                  Edit Post
                </a>

                <button onclick="deletePost('<%= post._id %>')"
                        class="px-5 py-3 bg-red-500 text-white rounded-lg text-sm font-semibold hover:bg-red-600 transition-all flex gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2"><path d="M10 11v6"/><path d="M14 11v6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M3 6h18"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                    Delete
                </button>
            </footer>
        <% } %>
    </article>
</main>

<%- include('../partials/footer') %>
<script>
  async function deletePost(postId) {
    if (!confirm('Are you sure you want to delete this?')) return;

    try {
      const response = await fetch(`/api/posts/${postId}`, {
        method: 'DELETE',
      });

      if (response.ok) location.href = '/posts';
      else alert('Failed to delete post.');
    } catch (err) {
      console.error('Client error: ', err);
    }
  }
</script>